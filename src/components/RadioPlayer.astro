---
// src/components/RadioPlayer.astro
const streamUrl = "https://us-b4-p-e-pb13-audio.cdn.mdstrm.com/live-audio-aw/5fab0687bcd6c2389ee9480c?aid=5faaeb72f92d7b07dfe10181&pid=EfUGrsUgMzljSB7Ph2G7ijdAxa4B6Szq&sid=oFljHxYrZd5TmU9X1Vnd3bp43efzRXct&uid=GshcXt0VmXk6KblxhNX5QyXIYuiz1UnS&es=us-b4-p-e-pb13-audio.cdn.mdstrm.com&ote=1727477677314&ot=JJYqOcZZyjmyXO_kE65o_Q&proto=https&pz=us&cP=128000&awCollectionId=5faaeb72f92d7b07dfe10181&liveId=5fab0687bcd6c2389ee9480c&referer=https%3A%2F%2Fwww.radio.es%2F&listenerId=GshcXt0VmXk6KblxhNX5QyXIYuiz1UnS";
---

<div class="radio-player fixed bottom-4 right-4 bg-secondary-600 rounded-full shadow-lg z-50 cursor-pointer" transition:persist transition:name="media-player">
  <!-- No necesitas el botón en este caso, todo el div será interactivo -->
  <svg id="play-icon" xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-5.197-3.6A1 1 0 008 8.401v7.198a1 1 0 001.555.832l5.197-3.6a1 1 0 000-1.664z" />
  </svg>
  <svg id="pause-icon" xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6" />
  </svg>

  <audio id="audio-player" autoplay={true}>
    <source src={streamUrl} type="audio/aac" />
    Your browser does not support the audio element.
  </audio>
</div>

<style>
  .radio-player {
    width: 60px;
    height: 60px;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  #play-icon, #pause-icon {
    transition: opacity 0.3s ease;
  }
</style>

<script lang="ts">
  document.addEventListener("DOMContentLoaded", () => {
    const audioPlayer = document.getElementById("audio-player");
    const radioPlayer = document.querySelector(".radio-player");
    const playIcon = document.getElementById("play-icon");
    const pauseIcon = document.getElementById("pause-icon");

    // Función para alternar entre play y pause
    const togglePlay = () => {
      if (audioPlayer.paused) {
        audioPlayer.play().catch((err) => {
          console.error("Error playing audio:", err);
        });
        playIcon.classList.add("hidden");
        pauseIcon.classList.remove("hidden");
      } else {
        audioPlayer.pause();
        pauseIcon.classList.add("hidden");
        playIcon.classList.remove("hidden");
      }
    };

    // Reproduce al hacer clic en cualquier parte del radio-player
    radioPlayer.addEventListener("click", togglePlay);

    // Función para reproducir el audio en la primera interacción
    const playOnInteraction = () => {
      if (audioPlayer.paused) {
        audioPlayer.play().catch((err) => console.log("Auto-play blocked", err));
        playIcon.classList.add("hidden");
        pauseIcon.classList.remove("hidden");
      }
      // Elimina este listener una vez que se ha activado
      document.removeEventListener("click", playOnInteraction);
    };
    // Detectar el primer evento de interacción del usuario para reproducir el audio
    document.addEventListener("click", playOnInteraction);
  });
</script>
